<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>リサージュ曲線の描画</title>
    <style>
        #lissajousCanvas {
            width: 80vh;  /* Viewport Heightの80% */
            height: 80vh; /* 縦も同じ比率で指定 */
        }

        /* ... その他のCSS ... */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: inner-spin-button;   /* スピンボタンの表示 */
            width: 10vh;
            opacity: 1;   /* 常に表示させる */
        }

        input[type="number"] {
            width: 20vh;  /* input全体の幅を調整 */
            height: 4vh;
            font-size: 4vh;
            padding-right: 4vh; /* スピンボタンと数字の間に余白を持たせる */
        }

        label {
            font-size: 4vh;
        }

        .center-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh; /* viewportの高さの100% */
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 1rem; /* 項目の間隔を設定 */
        }

        .control-group2 {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 1rem; /* 項目の間隔を設定 */
            font-size: 4vh;
        }

        #startAnimation{
            font-size: 4vh;
        }

        a#downloadLink {
            display: inline-block;
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            border: none;
            cursor: pointer;
            margin: 10px;
            transition-duration: 0.4s;
            border-radius: 5px;
        }

        a#downloadLink:hover {
            background-color: #45a049;
        }

    </style>
</head>
<body>

    <div class="center-wrapper"> <!-- 追加するラッパー -->
        <canvas id="lissajousCanvas"></canvas>
        <div class="control-group"> <!-- a, b の制御を囲む -->
            <label for="aValue">a:</label>
            <input type="number" id="aValue" value="3" min="1" max="100" step="1" oninput="updateAndDraw()">
            <label for="bValue">b:</label>
            <input type="number" id="bValue" value="2" min="1" max="100" step="1" oninput="updateAndDraw()">
        </div>
    
        <div class="control-group"> <!-- 色の制御を囲む -->
            <label for="innerColor">内側の色:</label>
            <input type="color" id="innerColor" value="#FFFFFF" oninput="updateAndDraw()" style="width: 10vh; height: 4vh; font-size: 4vh;">
            <label for="outerColor">外側の色:</label>
            <input type="color" id="outerColor" value="#000000" oninput="updateAndDraw()" style="width: 10vh; height: 4vh; font-size: 4vh;">
            <label for="lineColor">線の色:</label>
            <input type="color" id="lineColor" value="#000000" oninput="updateAndDraw()" style="width: 10vh; height: 4vh; font-size: 4vh;">
            <label for="lineWidth">線の太さ:</label>
            <input type="number" id="lineWidth" value="2" min="1" max="10" step="1" oninput="updateAndDraw()" style="width: 10vh; height: 4vh; font-size: 4vh;">
        </div>

        <div class="control-group2">
            <button id="startAnimation">START</button>
            <!-- 画像として保存するためのダウンロードリンク -->
            <a id="downloadLink" download="lissajous.png">画像としてダウンロード</a>
        </div>
    </div>

<script>
    const canvas = document.getElementById('lissajousCanvas');
    canvas.width = canvas.offsetWidth;  // 実際の描画幅をCSSの幅に合わせる
    canvas.height = canvas.offsetHeight; // 実際の描画高さをCSSの高さに合わせる
    const ctx = canvas.getContext('2d');
    const aInput = document.getElementById('aValue');
    const bInput = document.getElementById('bValue');

    const A = canvas.width / 2 * 0.8;  // Adjusting amplitude based on the canvas size
    const B = canvas.height / 2 * 0.8;
    const offsetX = canvas.width / 2;
    const offsetY = canvas.height / 2;
    
    // ... 既存のJavaScript ...
    const innerColorInput = document.getElementById('innerColor');
    const outerColorInput = document.getElementById('outerColor');
    const lineColorInput = document.getElementById('lineColor');
    const lineWidthInput = document.getElementById('lineWidth');

    function drawLissajousCurve(a, b) {
        // 現在のキャンバスの状態を保存
        ctx.save();        

        const innerColor = innerColorInput.value;
        const outerColor = outerColorInput.value;
        const lineColor = lineColorInput.value;
        const lineWidth = parseFloat(lineWidthInput.value);

        // グラデーションの作成
        const gradient = ctx.createRadialGradient(offsetX, offsetY, 0, offsetX, offsetY, canvas.width / 2);
        gradient.addColorStop(0, innerColor);
        gradient.addColorStop(1, outerColor);

        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height); // グラデーション背景の適用

        ctx.strokeStyle = lineColor; // 線の色の更新
        ctx.lineWidth = lineWidth;   // 線の太さの更新
        
        const avgValue = (a + b) / 2;
        const stepSize = 0.01 / (avgValue / 10);

        ctx.beginPath();
        for (let t = 0; t < 2 * Math.PI; t += stepSize) {
            const x = A * Math.sin(a * t) + offsetX;
            const y = B * Math.sin(b * t) + offsetY;
            ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.stroke();

        // クリッピング領域を設定
        ctx.clip();

        // 線の色で塗りつぶし
        ctx.fillStyle = lineColor;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // クリッピングをリセット
        ctx.restore();
    }

    function updateDownloadLink() {
        const downloadLink = document.getElementById('downloadLink');
        const dataURL = canvas.toDataURL('image/jpeg');
        downloadLink.href = dataURL;
        downloadLink.download = "lissajous.jpg";  // ファイルの拡張子を .png から .jpg に変更
    }

    function updateAndDraw() {
        const a = parseFloat(aInput.value);
        const b = parseFloat(bInput.value);
        drawLissajousCurve(a, b);
        updateDownloadLink();  // この行を追加
    }

    // 初期描画
    updateAndDraw();

    let bValue = 1;
    const bMax = 100;
    const animationDelay = 100; // 0.5秒

    function startAnimation() {
        // 初期値の設定
        bValue = 1;

        // アニメーションの実行
        function step() {
            if (bValue <= bMax) {
                bInput.value = bValue;
                aInput.value = bValue - 1; // aの値をb-1に設定

                updateAndDraw();

                bValue+=2;
                setTimeout(step, animationDelay); // 次のステップをスケジュール
            }
        }

        step(); // 最初のステップを実行
    }

    document.getElementById('startAnimation').addEventListener('click', startAnimation);


</script>
</body>
</html>
